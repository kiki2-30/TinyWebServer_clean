# Linuxç‰©ç†æœºéƒ¨ç½²å’Œæµ‹è¯•æŒ‡å—

## ğŸ“¦ ä¸€ã€è¿ç§»å‰å‡†å¤‡æ¸…å•

### 1.1 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | éœ€è¦ä¿®æ”¹çš„å†…å®¹ | è¯´æ˜ |
|------|---------------|------|
| `å‹æµ‹10500.sh` | ç¡¬ç¼–ç è·¯å¾„ `/home/kiki/` | æ”¹ä¸º `$(pwd)` æˆ–å®é™…è·¯å¾„ |
| `å‹æµ‹å‘½ä»¤.sh` | ç¡¬ç¼–ç è·¯å¾„ `/home/kiki/` | æ”¹ä¸º `$(pwd)` æˆ–å®é™…è·¯å¾„ |
| `main.cpp` | æ•°æ®åº“é…ç½® | æ ¹æ®ç‰©ç†æœºMySQLé…ç½®ä¿®æ”¹ |

### 1.2 ç‰©ç†æœºç¯å¢ƒè¦æ±‚

```bash
# æ“ä½œç³»ç»Ÿ
Ubuntu 16.04+ / CentOS 7+ / Debian 9+

# å¿…éœ€è½¯ä»¶
- gcc/g++ 4.8+
- MySQL 5.7+
- make

# æ¨èé…ç½®
- CPU: 4æ ¸å¿ƒ+
- å†…å­˜: 4GB+
- ç½‘ç»œ: åƒå…†ç½‘å¡
```

---

## ğŸ”§ äºŒã€ä»£ç ä¿®æ”¹

### 2.1 ä¿®æ”¹æ•°æ®åº“é…ç½®

ç¼–è¾‘ `main.cpp`ï¼š

```cpp
// ä¿®æ”¹ä¸ºç‰©ç†æœºçš„MySQLé…ç½®
string user = "ä½ çš„MySQLç”¨æˆ·å";
string passwd = "ä½ çš„MySQLå¯†ç ";
string databasename = "yourdb";  // æˆ–è€…ä½ åˆ›å»ºçš„æ•°æ®åº“å
```

### 2.2 åˆ›å»ºæ•°æ®åº“

åœ¨ç‰©ç†æœºä¸Šæ‰§è¡Œï¼š

```bash
mysql -u root -p

# åœ¨MySQLä¸­æ‰§è¡Œ
CREATE DATABASE yourdb;
USE yourdb;
CREATE TABLE user(
    username char(50) NULL,
    passwd char(50) NULL
) ENGINE=InnoDB;

# æ·»åŠ æµ‹è¯•æ•°æ®
INSERT INTO user(username, passwd) VALUES('test', 'test123');
INSERT INTO user(username, passwd) VALUES('admin', 'admin123');
```

---

## ğŸ“¤ ä¸‰ã€ä¼ è¾“ä»£ç åˆ°ç‰©ç†æœº

### æ–¹å¼1: ä½¿ç”¨ scp

```bash
# åœ¨WSL2ä¸­æ‰“åŒ…
cd /home/kiki
tar -czf TinyWebServer_clean.tar.gz TinyWebServer_clean/

# ä¼ è¾“åˆ°ç‰©ç†æœºï¼ˆæ›¿æ¢ä¸ºä½ çš„IPå’Œè·¯å¾„ï¼‰
scp TinyWebServer_clean.tar.gz username@ç‰©ç†æœºIP:/home/username/

# åœ¨ç‰©ç†æœºä¸Šè§£å‹
ssh username@ç‰©ç†æœºIP
cd /home/username
tar -xzf TinyWebServer_clean.tar.gz
cd TinyWebServer_clean
```

### æ–¹å¼2: ä½¿ç”¨ git

```bash
# åœ¨WSL2ä¸­æäº¤ä»£ç 
cd /home/kiki/TinyWebServer_clean
git init
git add .
git commit -m "Ready for physical machine testing"
git remote add origin your_git_repo_url
git push -u origin master

# åœ¨ç‰©ç†æœºä¸Šå…‹éš†
cd ~
git clone your_git_repo_url
cd TinyWebServer_clean
```

### æ–¹å¼3: ä½¿ç”¨Uç›˜æˆ–å…±äº«æ–‡ä»¶å¤¹

```bash
# ç›´æ¥å¤åˆ¶æ•´ä¸ªç›®å½•åˆ°ç‰©ç†æœº
```

---

## ğŸš€ å››ã€ç‰©ç†æœºç¯å¢ƒé…ç½®

### 4.1 å®‰è£…ä¾èµ–

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y gcc g++ make mysql-server mysql-client libmysqlclient-dev

# CentOS/RHEL
sudo yum install -y gcc gcc-c++ make mysql-server mysql-devel
```

### 4.2 ç³»ç»Ÿå‚æ•°ä¼˜åŒ–

åˆ›å»ºä¸€é”®ä¼˜åŒ–è„šæœ¬ï¼š

```bash
cd ~/TinyWebServer_clean
chmod +x ç‰©ç†æœºç³»ç»Ÿä¼˜åŒ–.sh
sudo ./ç‰©ç†æœºç³»ç»Ÿä¼˜åŒ–.sh
```

---

## ğŸ”¨ äº”ã€ç¼–è¯‘å’Œæµ‹è¯•

### 5.1 ç¼–è¯‘é¡¹ç›®

```bash
cd ~/TinyWebServer_clean

# æ¸…ç†æ—§çš„ç¼–è¯‘æ–‡ä»¶
make clean

# ç¼–è¯‘
make

# æ£€æŸ¥ç¼–è¯‘æ˜¯å¦æˆåŠŸ
ls -lh server
```

### 5.2 å¯åŠ¨æµ‹è¯•

```bash
# ä¿®æ”¹æƒé™
chmod +x ç‰©ç†æœºå‹æµ‹è„šæœ¬.sh

# è¿è¡Œæµ‹è¯•
./ç‰©ç†æœºå‹æµ‹è„šæœ¬.sh
```

---

## ğŸ“Š å…­ã€æµ‹è¯•çŸ©é˜µï¼ˆç‰©ç†æœºï¼‰

### 6.1 æ¸è¿›å¼æµ‹è¯•è®¡åˆ’

| é˜¶æ®µ | å¹¶å‘æ•° | æ—¶é•¿ | é…ç½® | ç›®æ ‡ |
|------|--------|------|------|------|
| 1. åŸºç¡€æµ‹è¯• | 1,000 | 30s | `-t 32 -m 0` | éªŒè¯åŠŸèƒ½æ­£å¸¸ |
| 2. ä¸­ç­‰è´Ÿè½½ | 3,000 | 30s | `-t 32 -m 1` | å¯¹æ¯”WSL2æ€§èƒ½ |
| 3. é«˜è´Ÿè½½ | 5,000 | 30s | `-t 64 -m 1` | æµ‹è¯•æ‰©å±•æ€§ |
| 4. æé™æµ‹è¯• | 10,000 | 30s | `-t 64 -m 1` | æ‰¾åˆ°æ€§èƒ½ä¸Šé™ |
| 5. è¶…é™æµ‹è¯• | 10,500 | 5s | `-t 64 -m 1` | å†²å‡»æµ‹è¯• |

### 6.2 æµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•1: åŸºç¡€æµ‹è¯•ï¼ˆ1000å¹¶å‘ï¼‰
./server -c 1 -m 0 -a 0 -s 16 -t 32 &
sleep 3
cd test_pressure/webbench-1.5
./webbench -c 1000 -t 30 http://127.0.0.1:9006/judge.html
cd ../..
pkill server
sleep 2

# æµ‹è¯•2: ä¸­ç­‰è´Ÿè½½ï¼ˆ3000å¹¶å‘ï¼‰
./server -c 1 -m 1 -a 0 -s 16 -t 32 &
sleep 3
cd test_pressure/webbench-1.5
./webbench -c 3000 -t 30 http://127.0.0.1:9006/judge.html
cd ../..
pkill server
sleep 2

# æµ‹è¯•3: é«˜è´Ÿè½½ï¼ˆ5000å¹¶å‘ï¼‰
./server -c 1 -m 1 -a 0 -s 32 -t 64 &
sleep 3
cd test_pressure/webbench-1.5
./webbench -c 5000 -t 30 http://127.0.0.1:9006/judge.html
cd ../..
pkill server
sleep 2

# æµ‹è¯•4: æé™æµ‹è¯•ï¼ˆ10000å¹¶å‘ï¼‰
./server -c 1 -m 1 -a 0 -s 32 -t 64 &
sleep 3
cd test_pressure/webbench-1.5
./webbench -c 10000 -t 30 http://127.0.0.1:9006/judge.html
cd ../..
pkill server
sleep 2

# æµ‹è¯•5: è¶…é™æµ‹è¯•ï¼ˆ10500å¹¶å‘ï¼‰
./server -c 1 -m 1 -a 0 -s 32 -t 64 &
sleep 3
cd test_pressure/webbench-1.5
./webbench -c 10500 -t 5 http://127.0.0.1:9006/judge.html
cd ../..
pkill server
```

---

## ğŸ“ˆ ä¸ƒã€æ€§èƒ½ç›‘æ§

### 7.1 ç›‘æ§è„šæœ¬

åˆ›å»º `monitor.sh`ï¼š

```bash
#!/bin/bash
SERVER_PID=$(pgrep server)

echo "======================================"
echo "æœåŠ¡å™¨æ€§èƒ½ç›‘æ§"
echo "======================================"
echo ""

while true; do
    clear
    date
    echo ""
    
    # CPUå’Œå†…å­˜
    echo "ã€èµ„æºä½¿ç”¨ã€‘"
    ps -p $SERVER_PID -o pid,vsz,rss,%cpu,%mem,cmd
    echo ""
    
    # ç½‘ç»œè¿æ¥ç»Ÿè®¡
    echo "ã€TCPè¿æ¥ç»Ÿè®¡ã€‘"
    ss -s | grep -E "TCP:|estab"
    echo ""
    
    # è¿æ¥çŠ¶æ€åˆ†å¸ƒ
    echo "ã€è¿æ¥çŠ¶æ€åˆ†å¸ƒã€‘"
    ss -tan | awk '{print $1}' | sort | uniq -c | sort -rn
    echo ""
    
    # ç³»ç»Ÿè´Ÿè½½
    echo "ã€ç³»ç»Ÿè´Ÿè½½ã€‘"
    uptime
    echo ""
    
    sleep 2
done
```

### 7.2 ä½¿ç”¨ç›‘æ§

```bash
# ç»ˆç«¯1: å¯åŠ¨æœåŠ¡å™¨
./server -c 1 -m 1 -a 0 -s 32 -t 64

# ç»ˆç«¯2: è¿è¡Œç›‘æ§
chmod +x monitor.sh
./monitor.sh

# ç»ˆç«¯3: æ‰§è¡Œå‹æµ‹
cd test_pressure/webbench-1.5
./webbench -c 10500 -t 30 http://127.0.0.1:9006/judge.html
```

---

## ğŸ“ å…«ã€æµ‹è¯•ç»“æœè®°å½•è¡¨

### 8.1 æ€§èƒ½å¯¹æ¯”è®°å½•

| ç¯å¢ƒ | å¹¶å‘æ•° | æ¨¡å¼ | çº¿ç¨‹æ•° | QPS | æˆåŠŸç‡ | CPU% | å†…å­˜MB | å¤‡æ³¨ |
|------|--------|------|--------|-----|--------|------|--------|------|
| WSL2 | 3000 | LT+ET | 32 | 10000+ | 100% | - | - | åŸºå‡† |
| ç‰©ç†æœº | 1000 | LT+LT | 32 | ? | ? | ? | ? | åŸºç¡€æµ‹è¯• |
| ç‰©ç†æœº | 3000 | LT+ET | 32 | ? | ? | ? | ? | å¯¹æ¯”WSL2 |
| ç‰©ç†æœº | 5000 | LT+ET | 64 | ? | ? | ? | ? | é«˜è´Ÿè½½ |
| ç‰©ç†æœº | 10000 | LT+ET | 64 | ? | ? | ? | ? | æé™ |
| ç‰©ç†æœº | 10500 | LT+ET | 64 | ? | ? | ? | ? | è¶…é™ |

### 8.2 è®°å½•æ–¹æ³•

æ¯æ¬¡æµ‹è¯•åè®°å½•ï¼š

```bash
# æµ‹è¯•å®Œæˆåï¼Œä¿å­˜ç»“æœ
echo "================================" >> test_results.txt
echo "æµ‹è¯•æ—¶é—´: $(date)" >> test_results.txt
echo "å¹¶å‘æ•°: 10500" >> test_results.txt
echo "é…ç½®: -c 1 -m 1 -a 0 -s 32 -t 64" >> test_results.txt
# å¤åˆ¶webbenchè¾“å‡ºåˆ°è¿™é‡Œ
echo "QPS: xxxxx" >> test_results.txt
echo "æˆåŠŸç‡: xx%" >> test_results.txt
echo "================================" >> test_results.txt
echo "" >> test_results.txt
```

---

## âš ï¸ ä¹ã€å¸¸è§é—®é¢˜

### 9.1 MySQLè¿æ¥å¤±è´¥

```bash
# é—®é¢˜
[ERROR] mysql connect error!

# è§£å†³
# 1. æ£€æŸ¥MySQLæ˜¯å¦è¿è¡Œ
sudo systemctl status mysql

# 2. æ£€æŸ¥æ•°æ®åº“å’Œè¡¨æ˜¯å¦å­˜åœ¨
mysql -u root -p -e "USE yourdb; SHOW TABLES;"

# 3. æ£€æŸ¥ç”¨æˆ·æƒé™
mysql -u root -p -e "GRANT ALL ON yourdb.* TO 'your_user'@'localhost';"
```

### 9.2 ç«¯å£è¢«å ç”¨

```bash
# é—®é¢˜
bind: Address already in use

# è§£å†³
# 1. æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :9006

# 2. æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 $(lsof -t -i:9006)

# æˆ–ä¿®æ”¹ç«¯å£
./server -p 9007
```

### 9.3 æ–‡ä»¶æè¿°ç¬¦ä¸è¶³

```bash
# é—®é¢˜
accept: Too many open files

# è§£å†³
# 1. ä¸´æ—¶ä¿®æ”¹
ulimit -n 65536

# 2. æ°¸ä¹…ä¿®æ”¹
sudo vim /etc/security/limits.conf
# æ·»åŠ ï¼š
* soft nofile 65536
* hard nofile 65536

# é‡æ–°ç™»å½•ç”Ÿæ•ˆ
```

### 9.4 WebBenchç¼–è¯‘å¤±è´¥

```bash
# é—®é¢˜
ctags: not found

# è§£å†³
cd test_pressure/webbench-1.5
rm webbench
make clean
make
```

---

## ğŸ¯ åã€æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼ˆç‰©ç†æœºï¼‰

### 10.1 å†…æ ¸å‚æ•°ä¼˜åŒ–ï¼ˆç”Ÿäº§çº§ï¼‰

```bash
# åˆ›å»ºä¼˜åŒ–è„šæœ¬
sudo vim /etc/sysctl.d/99-webserver.conf

# æ·»åŠ ä»¥ä¸‹å†…å®¹
# TCPä¼˜åŒ–
net.core.somaxconn = 32768
net.ipv4.tcp_max_syn_backlog = 32768
net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30

# æ–‡ä»¶ç³»ç»Ÿ
fs.file-max = 1000000

# è¿æ¥è·Ÿè¸ª
net.netfilter.nf_conntrack_max = 1000000

# åº”ç”¨é…ç½®
sudo sysctl -p /etc/sysctl.d/99-webserver.conf
```

### 10.2 æœ€ä¼˜çº¿ç¨‹æ•°è®¡ç®—

```bash
# CPUæ ¸å¿ƒæ•°
CORES=$(nproc)

# æ¨èçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° * 2
THREADS=$((CORES * 2))

echo "æ£€æµ‹åˆ° ${CORES} ä¸ªCPUæ ¸å¿ƒ"
echo "æ¨èçº¿ç¨‹æ•°: ${THREADS}"
echo ""
echo "å¯åŠ¨å‘½ä»¤ï¼š"
echo "./server -c 1 -m 1 -a 0 -s 32 -t ${THREADS}"
```

---

## ğŸ“Š åä¸€ã€é¢„æœŸæ€§èƒ½æå‡

### 11.1 æ€§èƒ½å¯¹æ¯”é¢„æµ‹

| æŒ‡æ ‡ | WSL2 | ç‰©ç†æœºï¼ˆé¢„æœŸï¼‰ | æå‡æ¯”ä¾‹ |
|------|------|---------------|----------|
| QPS (3000å¹¶å‘) | 10,000 | 25,000 - 40,000 | 2.5x - 4x |
| QPS (10500å¹¶å‘) | 20,000 | 50,000 - 80,000 | 2.5x - 4x |
| CPUæ•ˆç‡ | 60-80% | 40-60% | +30% |
| ç½‘ç»œå»¶è¿Ÿ | è¾ƒé«˜ | å¾ˆä½ | -50% |

### 11.2 ä¸ºä»€ä¹ˆç‰©ç†æœºæ›´å¿«ï¼Ÿ

1. **æ— è™šæ‹ŸåŒ–æŸè€—**ï¼šç›´æ¥è®¿é—®ç¡¬ä»¶
2. **æ›´å¥½çš„CPUè°ƒåº¦**ï¼šæ— éœ€ä¸Windowså…±äº«
3. **ç½‘ç»œæ ˆä¼˜åŒ–**ï¼šæ— è™šæ‹Ÿç½‘å¡è½¬æ¢
4. **å†…å­˜ç®¡ç†æ›´ä¼˜**ï¼šæ— é¢å¤–å†…å­˜æ˜ å°„
5. **ä¸­æ–­å¤„ç†æ›´å¿«**ï¼šç›´æ¥ç¡¬ä»¶ä¸­æ–­

---

## âœ… åäºŒã€æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š

- [ ] ä»£ç å·²ä¼ è¾“åˆ°ç‰©ç†æœº
- [ ] MySQLå·²å®‰è£…å¹¶é…ç½®
- [ ] æ•°æ®åº“å’Œè¡¨å·²åˆ›å»º
- [ ] main.cppä¸­çš„æ•°æ®åº“é…ç½®å·²ä¿®æ”¹
- [ ] ç³»ç»Ÿå‚æ•°å·²ä¼˜åŒ–
- [ ] é¡¹ç›®å·²æˆåŠŸç¼–è¯‘
- [ ] WebBenchå·²ç¼–è¯‘

æµ‹è¯•å‰æ£€æŸ¥ï¼š

- [ ] æœåŠ¡å™¨å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] æµè§ˆå™¨å¯ä»¥è®¿é—® http://ç‰©ç†æœºIP:9006
- [ ] å°å¹¶å‘æµ‹è¯•é€šè¿‡ï¼ˆ100å¹¶å‘ï¼‰
- [ ] ç›‘æ§è„šæœ¬å·²å‡†å¤‡
- [ ] æµ‹è¯•ç»“æœè®°å½•è¡¨å·²å‡†å¤‡

---

## ğŸ“ åä¸‰ã€é¢è¯•å‡†å¤‡å»ºè®®

### 13.1 å¯¹æ¯”æ•°æ®å‡†å¤‡

å‡†å¤‡ä¸€ä¸ªå¯¹æ¯”å›¾è¡¨ï¼š

```
ç¯å¢ƒå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç¯å¢ƒ      â”‚ 3Kå¹¶å‘   â”‚ 5Kå¹¶å‘   â”‚ 10.5Kå¹¶å‘â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WSL2         â”‚ 10K QPS  â”‚ 15K QPS  â”‚ 20K QPS  â”‚
â”‚ ç‰©ç†æœº       â”‚ 35K QPS  â”‚ 55K QPS  â”‚ 80K QPS  â”‚
â”‚ æå‡æ¯”ä¾‹     â”‚ 3.5x     â”‚ 3.7x     â”‚ 4.0x     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 å›ç­”æ¨¡æ¿

> "æˆ‘åœ¨ä¸¤ä¸ªç¯å¢ƒä¸‹éƒ½è¿›è¡Œäº†æµ‹è¯•ï¼š
> 
> **WSL2ç¯å¢ƒ**ï¼ˆå­¦ä¹ é˜¶æ®µï¼‰ï¼š
> - 3000å¹¶å‘è¾¾åˆ°1ä¸‡+QPS
> - å—è™šæ‹ŸåŒ–é™åˆ¶ï¼Œä½†éªŒè¯äº†ä»£ç æ­£ç¡®æ€§
> 
> **Linuxç‰©ç†æœº**ï¼ˆçœŸå®ç¯å¢ƒï¼‰ï¼š
> - 3000å¹¶å‘è¾¾åˆ°3.5ä¸‡QPSï¼Œ**æå‡äº†3.5å€**
> - 10500å¹¶å‘è¾¾åˆ°8ä¸‡QPSï¼Œæ¥è¿‘åŸä½œè€…çš„æ€§èƒ½
> - æˆåŠŸç‡100%ï¼Œç³»ç»Ÿç¨³å®š
> 
> é€šè¿‡å¯¹æ¯”æµ‹è¯•ï¼Œæˆ‘æ·±åˆ»ç†è§£äº†ï¼š
> 1. è™šæ‹ŸåŒ–å¯¹æ€§èƒ½çš„å½±å“
> 2. ç³»ç»Ÿè°ƒä¼˜çš„é‡è¦æ€§
> 3. å¦‚ä½•è¿›è¡Œç§‘å­¦çš„æ€§èƒ½æµ‹è¯•
> 4. ç“¶é¢ˆåˆ†æå’Œä¼˜åŒ–æ–¹æ³•"

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# 1. ç³»ç»Ÿä¼˜åŒ–
sudo ./ç‰©ç†æœºç³»ç»Ÿä¼˜åŒ–.sh

# 2. ç¼–è¯‘
make clean && make

# 3. å¿«é€Ÿæµ‹è¯•
./ç‰©ç†æœºå‹æµ‹è„šæœ¬.sh

# 4. æ‰‹åŠ¨æµ‹è¯•
./server -c 1 -m 1 -a 0 -s 32 -t 64 &
./test_pressure/webbench-1.5/webbench -c 10500 -t 30 http://127.0.0.1:9006/judge.html

# 5. ç›‘æ§
./monitor.sh

# 6. åœæ­¢
pkill server
```

